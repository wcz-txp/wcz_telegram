# Name: wcz_telegram v0.1 
# Type: Admin/AJAX plugin
# A simple plugin to post articles to Telegram
# Author: whocarez
# URL: https://github.com/wcz-txp/wcz_telegram
# Recommended load order: 5

# .....................................................................
# This is a plugin for Textpattern CMS - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# .....................................................................

YToxMTp7czo0OiJuYW1lIjtzOjEyOiJ3Y3pfdGVsZWdyYW0iO3M6NjoiYXV0aG9yIjtzOjg6
Indob2NhcmV6IjtzOjEwOiJhdXRob3JfdXJpIjtzOjM5OiJodHRwczovL2dpdGh1Yi5jb20v
d2N6LXR4cC93Y3pfdGVsZWdyYW0iO3M6NzoidmVyc2lvbiI7czozOiIwLjEiO3M6MTE6ImRl
c2NyaXB0aW9uIjtzOjQ0OiJBIHNpbXBsZSBwbHVnaW4gdG8gcG9zdCBhcnRpY2xlcyB0byBU
ZWxlZ3JhbSI7czo0OiJjb2RlIjtzOjM2NDE6IgovKgpQYXJ0bHkgaW5zcGlyZWQgYnkgQW5k
eSBDYXJ0ZXIncyBhcmNfdHdpdHRlcgpodHRwOi8vYW5keS1jYXJ0ZXIuY29tL3R4cC9hcmNf
dHdpdHRlcgoqLwoKaWYgKHR4cGludGVyZmFjZSA9PSAnYWRtaW4nKQp7CiAgICBhZGRfcHJp
dnMoJ3djel90ZWxlZ3JhbV9wb3N0JywgJzEnKTsKCiAgICByZWdpc3Rlcl9jYWxsYmFjaygn
d2N6X3RlbGVncmFtJywgJ2FydGljbGUnLCAnZWRpdCcpOwoKICAgIHJlZ2lzdGVyX2NhbGxi
YWNrKCd3Y3pfdGVsZWdyYW1fdWknLCAnYXJ0aWNsZV91aScsICdzdGF0dXMnKTsKCn0KCi8v
IFJlZ2lzdGVyIHRhZ3MuClR4cDo6Z2V0KCdcVGV4dHBhdHRlcm5cVGFnXFJlZ2lzdHJ5JykK
ICAgIC0+cmVnaXN0ZXIoJ3djel90ZWxlZ3JhbScpOwoKCgoKZnVuY3Rpb24gd2N6X3RlbGVn
cmFtX3VpKCRldmVudCwgJHN0ZXAsICRkYXRhLCAkcnMxKSB7CgogICAgJHZhciA9IGdwcygn
d2N6X3RlbGVncmFtX190aGlzJyk7CiAgICAkY29udGVudCAgPSB0YWcoeWVzbm9SYWRpbygn
d2N6X3RlbGVncmFtX190aGlzJywgJzAnLCAnJywgJ3djel90ZWxlZ3JhbV9fdGhpcycpLCdw
Jyk7CiAgICByZXR1cm4gJGRhdGEuZmllbGRzZXQoJGNvbnRlbnQsICdTZW5kIHRvIFRlbGVn
cmFtJywgJ3djel90ZWxlZ3JhbScpOwoKfQoKCgoKZnVuY3Rpb24gd2N6X3RlbGVncmFtKCkg
ewoKCiAgICAkYXJ0aWNsZV9pZCA9IGVtcHR5KCRHTE9CQUxTWydJRCddKSA/IGdwcygnSUQn
KSA6ICRHTE9CQUxTWydJRCddOwogICAgJFN0YXR1cyA9IGVtcHR5KCRHTE9CQUxTWydTdGF0
dXMnXSkgPyBncHMoJ1N0YXR1cycpIDogJEdMT0JBTFNbJ1N0YXR1cyddOwogICAgJHdjel90
ZWxlZ3JhbV9fdGhpcyA9IGVtcHR5KCRHTE9CQUxTWyd3Y3pfdGVsZWdyYW1fX3RoaXMnXSkg
PyBncHMoJ3djel90ZWxlZ3JhbV9fdGhpcycpIDogJEdMT0JBTFNbJ3djel90ZWxlZ3JhbV9f
dGhpcyddOwoKICAgIGlmICgkU3RhdHVzID09IDQgYW5kICR3Y3pfdGVsZWdyYW1fX3RoaXMg
PT0gMSkKICAgIHsKCgoJaWYgKCFlbXB0eSgkYXJ0aWNsZV9pZCkpIAoJewoKCSAgICBpbmNs
dWRlX29uY2UgdHhwYXRoLicvcHVibGlzaC90YWdoYW5kbGVycy5waHAnOwoKCSAgICAkYXJ0
aWNsZSA9IHNhZmVfcm93KCJJRCwgUG9zdGVkLCBMYXN0TW9kLCBUaXRsZSwgRXhjZXJwdCwg
S2V5d29yZHMsIFN0YXR1cyIsICd0ZXh0cGF0dGVybicsIklEPXskYXJ0aWNsZV9pZH0iKTsK
CX0KCgoJJGFydGljbGVfdXJsID0gcGVybWxpbmt1cmwoJGFydGljbGUpOwoJJHRpdGxlID0g
JGFydGljbGVbJ1RpdGxlJ107CgkkZXhjZXJwdCA9ICRhcnRpY2xlWydFeGNlcnB0J107Cgkk
a2V5d29yZHMgPSAkYXJ0aWNsZVsnS2V5d29yZHMnXTsKCi8vIHRoZSB0b2tlbiBvZiB5b3Vy
IFRlbGVncmFtIGJvdAoJJHdjel90ZWxlZ3JhbV90b2tlbiA9ICcnOwoKLy8gdGhlIGNoYXRp
ZCBvZiB5b3VyIFRlbGVncmFtIGNoYW5uZWwKCSR3Y3pfdGVsZWdyYW1fY2hhdGlkID0gJyc7
CgovLyBJZiB5b3UgaGF2ZSBhbHJlYWR5IGEgVGVsZWdyYW0gSW5zdGFudCBWaWV3IHRlbXBs
YXRlIChodHRwczovL2luc3RhbnR2aWV3LnRlbGVncmFtLm9yZy8jcHVibGlzaGluZy10ZW1w
bGF0ZXMpLCBidXQgdGhpcyBpcyBub3QgcmVhbGx5IHB1YmxpYwovLyB5b3Ugc2hvdWxkIGNv
bnNpZGVyIHRvIHVzZSB0aGlzIG9wdGlvbi4gU2V0IGl0IHRvICcxJyBhbmQgY29weSB0aGUg
cmhhc2gsIHNvIFRlbGVncmFtIHVzZXJzIHdpbGwgc2VlIHlvdXIgYXJ0aWNsZSBvbiB0aGVp
ciBtb2JpbGVzCi8vIGluc2lkZSBUZWxlZ3JhbSByZW5kZXJlZCB3aXRoIHlvdXIgdGVtcGxh
dGUuCgkkd2N6X3RlbGVncmFtX2l2ID0gJzAnOwoJJHdjel90ZWxlZ3JhbV9yaGFzaCA9ICcn
OwoKLy8gSWYgc29tZXRoaW5nIGRvZXNuJ3Qgd29yaywgc3dpdGNoIGl0IHRvICcxJyBhbmQg
eW91J2xsIGdldCB0aGUgY29tcGxldGUgcmVxdWVzdCBpbnNpZGUgb2YgdGV4dHBhdHRlcm4v
dG1wL3RlbGVncmFtX3JlcXVlc3QudHh0Cgkkd2N6X3RlbGVncmFtX2RlYnVnID0gJzAnOwoK
CWlmICgkd2N6X3RlbGVncmFtX2l2ID09ICcxJykgCgl7CgkgICAgJGFydGljbGVfdXJsID0g
Imh0dHBzOi8vdC5tZS9pdj91cmw9Ii4kYXJ0aWNsZV91cmwuIiZyaGFzaD0iLiR3Y3pfdGVs
ZWdyYW1fcmhhc2g7Cgl9CgoKLy8gIGVzY2FwZSBNYXJrZG93biBmb3JtYXR0aW5nIGNoYXJh
Y3RlciAiXyIKCSRhcnRpY2xlX3VybCA9IHN0cl9yZXBsYWNlKCJfIiwiXF8iLCRhcnRpY2xl
X3VybCk7CgovLyAgcHJlcGFyZSBrZXl3b3JkcwoJJGtleXdvcmRzID0gZXhwbG9kZSgiLCIs
JGtleXdvcmRzKTsKCWZvcmVhY2ggKCRrZXl3b3JkcyBhcyAmJGtleXdvcmQpIAoJewoJICAg
ICRrZXl3b3JkID0gcHJlZ19yZXBsYWNlKCcvXHMrLycsICcnLG1iX2NvbnZlcnRfY2FzZSgk
a2V5d29yZCwgTUJfQ0FTRV9USVRMRSkpOwoJfQoKCSRrZXl3b3JkcyA9IGltcGxvZGUoIiAi
LHByZWdfZmlsdGVyKCcvXi8nLCAnIycsICRrZXl3b3JkcykpOwoKLy8gNDA5NiBjaGFyYWN0
ZXJzIGlzIHRoZSBtYXhpbXVtIHBvc3QgbGVuZ3RoCgoJJGV4Y2VycHRsZW4gPSA0MDgwIC0g
c3RybGVuKCR0aXRsZSkgLSBzdHJsZW4oJGtleXdvcmRzKSAtIHN0cmxlbigkYXJ0aWNsZV91
cmwpOwoKCWlmIChzdHJsZW4oJGV4Y2VycHQpID4gJGV4Y2VycHRsZW4pIAoJewoJICAgICRw
b3M9c3RycG9zKCRleGNlcnB0LCAnICcsICRleGNlcnB0bGVuKTsKCSAgICAkZXhjZXJwdCA9
ICciJy5zdWJzdHIoJGV4Y2VycHQsMCwkcG9zKS4nIiAuLi4nOwoJfQoKCSRtZXNzYWdlID0g
IioiLiR0aXRsZS4iKlxuXG4iLiRleGNlcnB0LiJcblxuIi4ka2V5d29yZHMuIlxuXG4iLiRh
cnRpY2xlX3VybDsKCgkkdXJsID0gJ2h0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3QnLiR3
Y3pfdGVsZWdyYW1fdG9rZW4uJy9zZW5kTWVzc2FnZT9jaGF0X2lkPScuJHdjel90ZWxlZ3Jh
bV9jaGF0aWQuJyZwYXJzZV9tb2RlPU1hcmtkb3duJnRleHQ9JzsKCSR1cmwgLj0gdXJsZW5j
b2RlKCRtZXNzYWdlKTsKCgovLyBzb21lIGRlYnVnIHN0dWZmCglpZiAoJHdjel90ZWxlZ3Jh
bV9kZWJ1ZyA9PSAiMSIpIAoJewoJICAgIGZpbGVfcHV0X2NvbnRlbnRzKHR4cGF0aC4iL3Rt
cC90ZWxlZ3JhbV9yZXF1ZXN0LnR4dCIsIlNlbnQgVVJMOiBcbiIuJHVybC4iXG5cblByZXBh
cmVkIG1lc3NhZ2U6XG4iLiRtZXNzYWdlLiJcblxuRXhjZXJwdCBsZW5ndGg6XG4iLiRleGNl
cnB0bGVuLiJcblxuQ3VybCBvdXRwdXQ6XG4iKTsKCX0KCgoJJGNoID0gY3VybF9pbml0KCk7
CgljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVJMLCAkdXJsKTsKCWN1cmxfc2V0b3B0KCRj
aCwgQ1VSTE9QVF9SRVRVUk5UUkFOU0ZFUiwgdHJ1ZSk7Ci8vIHNvbWUgZGVidWcgc3R1ZmYK
CWlmICgkd2N6X3RlbGVncmFtX2RlYnVnID09ICIxIikgCgl7CgkgICAgY3VybF9zZXRvcHQo
JGNoLCBDVVJMT1BUX1ZFUkJPU0UsIHRydWUpOwoJICAgICRjdXJsX3ZlcmJvc2UgPSBmb3Bl
bih0eHBhdGguJy90bXAvdGVsZWdyYW1fcmVxdWVzdC50eHQnLCAnYSsnKTsKCSAgICBjdXJs
X3NldG9wdCgkY2gsIENVUkxPUFRfU1RERVJSLCAkY3VybF92ZXJib3NlKTsKCX0KCgkkcmVz
cG9uc2UgPSBjdXJsX2V4ZWMoJGNoKTsKCWN1cmxfY2xvc2UoJGNoKTsKCiAgICB9Cn0KIjtz
OjQ6InR5cGUiO3M6MToiNCI7czo1OiJvcmRlciI7czoxOiI1IjtzOjU6ImZsYWdzIjtzOjE6
IjAiO3M6NDoiaGVscCI7czo3NDg6IkEgcmVhbGx5IHJhdyBwbHVnaW4gZm9yIGF1dG9tYXRp
YyBwb3N0aW5nIG5ldyBhcnRpY2xlcyB0byB0ZWxlZ3JhbS4gQWxsIHRoZSBwYXJhbWV0ZXJz
IGFyZSB5ZXQgaW5zaWRlIHRoZSBjb2RlLgoKKiAqd2N6X3RlbGVncmFtX3Rva2VuKjogdGhl
IHRva2VuIG9mIHlvdXIgVGVsZWdyYW0gYm90CiogKndjel90ZWxlZ3JhbV9jaGF0aWQqOiB0
aGUgY2hhdGlkIG9mIHlvdXIgVGVsZWdyYW0gY2hhbm5lbAoqICp3Y3pfdGVsZWdyYW1faXYq
IGFuZCAqd2N6X3RlbGVncmFtX3JoYXNoKjogSWYgeW91IGhhdmUgYWxyZWFkeSBhICIqVGVs
ZWdyYW0gSW5zdGFudCBWaWV3IHRlbXBsYXRlKiI6aHR0cHM6Ly9pbnN0YW50dmlldy50ZWxl
Z3JhbS5vcmcvI3B1Ymxpc2hpbmctdGVtcGxhdGVzLCBidXQgdGhpcyBpcyBub3QgcmVhbGx5
IHB1YmxpYyB5b3Ugc2hvdWxkIGNvbnNpZGVyIHRvIHVzZSB0aGlzIG9wdGlvbi4gU2V0IGl0
IHRvICcxJyBhbmQgY29weSB0aGUgcmhhc2gsIHNvIFRlbGVncmFtIHVzZXJzIHdpbGwgc2Vl
IHlvdXIgYXJ0aWNsZSBvbiB0aGVpciBtb2JpbGVzIGluc2lkZSBUZWxlZ3JhbSByZW5kZXJl
ZCB3aXRoIHlvdXIgdGVtcGxhdGUuCiogKndjel90ZWxlZ3JhbV9kZWJ1Zyo6IElmIHNvbWV0
aGluZyBkb2Vzbid0IHdvcmssIHN3aXRjaCBpdCB0byAnMScgYW5kIHlvdSdsbCBnZXQgdGhl
IGNvbXBsZXRlIHJlcXVlc3QgaW5zaWRlIG9mIGJjLiB0ZXh0cGF0dGVybi90bXAvdGVsZWdy
YW1fcmVxdWVzdC50eHQiO3M6MzoibWQ1IjtzOjMyOiJkY2ZkZDg1NTMzM2JiMjI5NjUwMDM0
NDQyNDk5N2E3ZiI7fQ==
